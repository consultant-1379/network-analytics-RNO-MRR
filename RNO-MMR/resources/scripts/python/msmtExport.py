# ********************************************************************
# Ericsson Inc.                                                 SCRIPT
# ********************************************************************
#
#
# (c) Ericsson Inc. 2020 - All rights reserved.
#
# The copyright to the computer program(s) herein is the property
# of Ericsson Inc. The programs may be used and/or copied only with
# the written permission from Ericsson Inc. or in accordance with the
# terms and conditions stipulated in the agreement/contract under
# which the program(s) have been supplied.
#
# ********************************************************************
# Name    : MsmtExport.py
# Date    : 01/01/2020
# Revision: 1.0
# Purpose : MsmtExport
#
# Usage   : NetAn RNO MRR
#

from Spotfire.Dxp.Data.Export import DataWriterTypeIdentifiers
from System.IO import File, Directory
from System.Collections.Generic import List
from datetime import datetime
import clr
import re
clr.AddReference('System.Data')  # needs to be imported before System.Data is called
import System
from System.IO import StringReader, StreamReader, StreamWriter, MemoryStream, SeekOrigin
from System.Collections.Generic import List
from Spotfire.Dxp.Data import *
from Spotfire.Dxp.Application.Visuals import *
from System import Array
from Spotfire.Dxp.Application.Visuals import TablePlot, VisualContent
from Spotfire.Dxp.Data import DataPropertyClass
from Spotfire.Dxp.Data import AddRowsSettings
from Spotfire.Dxp.Data.Import import DataTableDataSource
import time

# columns to be renamed for msmt report
msmtColumns = {
    "Cell Name":"CellName",
    "ChannelGroup":"ChannelGroup",
    "SubCell_String":"SubCellType",
    "No._of_Meas._Rep_Passed_Filter_MSMT":"NoReportsPassedFilter",
    "NoReportsUnfiltered_MSMT":"NoReportsUnfiltered",
    "Traffic Level Average (E)_MSMT":"TrafficLevelCS(E)",
    "TrafficLevelMaxCS(E)_MSMT":"TrafficLevelMaxCS(E)",
    "TrafficLevelMinCS(E)_MSMT":"TrafficLevelMinCS(E)",
    "No. of FER UL Passed Filter_MSMT":"NoFERULPassedFilter",
    "NoFERULUnfiltered_MSMT":"NoFERULUnfiltered",
    "No. of FER DL Passed Filter_MSMT":"NoFERDLPassedFilter",
    "NoFERDLUnfiltered_MSMT":"NoFERDLUnfiltered",
    "No. of FER UL&DL Passed Filter_MSMT":"NoFERULDLPassedFilter",
    "NoFERULDLUnfiltered_MSMT":"NoFERULDLUnfiltered",
    "CELL_BAND":"Band",
    "RXQUALUL0":"RXQUALUL(0,0)",
    "RXQUALUL1":"RXQUALUL(1,1)",
    "RXQUALUL2":"RXQUALUL(2,2)",
    "RXQUALUL3":"RXQUALUL(3,3)",
    "RXQUALUL4":"RXQUALUL(4,4)",
    "RXQUALUL5":"RXQUALUL(5,5)",
    "RXQUALUL6":"RXQUALUL(6,6)",
    "RXQUALUL7":"RXQUALUL(7,7)",
    "RXQUALDL0":"RXQUALDL(0,0)",
    "RXQUALDL1":"RXQUALDL(1,1)",
    "RXQUALDL2":"RXQUALDL(2,2)",
    "RXQUALDL3":"RXQUALDL(3,3)",
    "RXQUALDL4":"RXQUALDL(4,4)",
    "RXQUALDL5":"RXQUALDL(5,5)",
    "RXQUALDL6":"RXQUALDL(6,6)",
    "RXQUALDL7":"RXQUALDL(7,7)",
    "RXLEVUL0":"RXLEVUL(0,0)",
    "RXLEVUL1":"RXLEVUL(1,1)",
    "RXLEVUL2":"RXLEVUL(2,2)",
    "RXLEVUL3":"RXLEVUL(3,3)",
    "RXLEVUL4":"RXLEVUL(4,4)",
    "RXLEVUL5":"RXLEVUL(5,5)",
    "RXLEVUL6":"RXLEVUL(6,6)",
    "RXLEVUL7":"RXLEVUL(7,7)",
    "RXLEVUL8":"RXLEVUL(8,8)",
    "RXLEVUL9":"RXLEVUL(9,9)",
    "RXLEVUL10":"RXLEVUL(10,10)",
    "RXLEVUL11":"RXLEVUL(11,11)",
    "RXLEVUL12":"RXLEVUL(12,12)",
    "RXLEVUL13":"RXLEVUL(13,13)",
    "RXLEVUL14":"RXLEVUL(14,14)",
    "RXLEVUL15":"RXLEVUL(15,15)",
    "RXLEVUL16":"RXLEVUL(16,16)",
    "RXLEVUL17":"RXLEVUL(17,17)",
    "RXLEVUL18":"RXLEVUL(18,18)",
    "RXLEVUL19":"RXLEVUL(19,19)",
    "RXLEVUL20":"RXLEVUL(20,20)",
    "RXLEVUL21":"RXLEVUL(21,21)",
    "RXLEVUL22":"RXLEVUL(22,22)",
    "RXLEVUL23":"RXLEVUL(23,23)",
    "RXLEVUL24":"RXLEVUL(24,24)",
    "RXLEVUL25":"RXLEVUL(25,25)",
    "RXLEVUL26":"RXLEVUL(26,26)",
    "RXLEVUL27":"RXLEVUL(27,27)",
    "RXLEVUL28":"RXLEVUL(28,28)",
    "RXLEVUL29":"RXLEVUL(29,29)",
    "RXLEVUL30":"RXLEVUL(30,30)",
    "RXLEVUL31":"RXLEVUL(31,31)",
    "RXLEVUL32":"RXLEVUL(32,32)",
    "RXLEVUL33":"RXLEVUL(33,33)",
    "RXLEVUL34":"RXLEVUL(34,34)",
    "RXLEVUL35":"RXLEVUL(35,35)",
    "RXLEVUL36":"RXLEVUL(36,36)",
    "RXLEVUL37":"RXLEVUL(37,37)",
    "RXLEVUL38":"RXLEVUL(38,38)",
    "RXLEVUL39":"RXLEVUL(39,39)",
    "RXLEVUL40":"RXLEVUL(40,40)",
    "RXLEVUL41":"RXLEVUL(41,41)",
    "RXLEVUL42":"RXLEVUL(42,42)",
    "RXLEVUL43":"RXLEVUL(43,43)",
    "RXLEVUL44":"RXLEVUL(44,44)",
    "RXLEVUL45":"RXLEVUL(45,45)",
    "RXLEVUL46":"RXLEVUL(46,46)",
    "RXLEVUL47":"RXLEVUL(47,47)",
    "RXLEVUL48":"RXLEVUL(48,48)",
    "RXLEVUL49":"RXLEVUL(49,49)",
    "RXLEVUL50":"RXLEVUL(50,50)",
    "RXLEVUL51":"RXLEVUL(51,51)",
    "RXLEVUL52":"RXLEVUL(52,52)",
    "RXLEVUL53":"RXLEVUL(53,53)",
    "RXLEVUL54":"RXLEVUL(54,54)",
    "RXLEVUL55":"RXLEVUL(55,55)",
    "RXLEVUL56":"RXLEVUL(56,56)",
    "RXLEVUL57":"RXLEVUL(57,57)",
    "RXLEVUL58":"RXLEVUL(58,58)",
    "RXLEVUL59":"RXLEVUL(59,59)",
    "RXLEVUL60":"RXLEVUL(60,60)",
    "RXLEVUL61":"RXLEVUL(61,61)",
    "RXLEVUL62":"RXLEVUL(62,62)",
    "RXLEVUL63":"RXLEVUL(63,63)",
    "RXLEVDL0":"RXLEVDL(0,0)",
    "RXLEVDL1":"RXLEVDL(1,1)",
    "RXLEVDL2":"RXLEVDL(2,2)",
    "RXLEVDL3":"RXLEVDL(3,3)",
    "RXLEVDL4":"RXLEVDL(4,4)",
    "RXLEVDL5":"RXLEVDL(5,5)",
    "RXLEVDL6":"RXLEVDL(6,6)",
    "RXLEVDL7":"RXLEVDL(7,7)",
    "RXLEVDL8":"RXLEVDL(8,8)",
    "RXLEVDL9":"RXLEVDL(9,9)",
    "RXLEVDL10":"RXLEVDL(10,10)",
    "RXLEVDL11":"RXLEVDL(11,11)",
    "RXLEVDL12":"RXLEVDL(12,12)",
    "RXLEVDL13":"RXLEVDL(13,13)",
    "RXLEVDL14":"RXLEVDL(14,14)",
    "RXLEVDL15":"RXLEVDL(15,15)",
    "RXLEVDL16":"RXLEVDL(16,16)",
    "RXLEVDL17":"RXLEVDL(17,17)",
    "RXLEVDL18":"RXLEVDL(18,18)",
    "RXLEVDL19":"RXLEVDL(19,19)",
    "RXLEVDL20":"RXLEVDL(20,20)",
    "RXLEVDL21":"RXLEVDL(21,21)",
    "RXLEVDL22":"RXLEVDL(22,22)",
    "RXLEVDL23":"RXLEVDL(23,23)",
    "RXLEVDL24":"RXLEVDL(24,24)",
    "RXLEVDL25":"RXLEVDL(25,25)",
    "RXLEVDL26":"RXLEVDL(26,26)",
    "RXLEVDL27":"RXLEVDL(27,27)",
    "RXLEVDL28":"RXLEVDL(28,28)",
    "RXLEVDL29":"RXLEVDL(29,29)",
    "RXLEVDL30":"RXLEVDL(30,30)",
    "RXLEVDL31":"RXLEVDL(31,31)",
    "RXLEVDL32":"RXLEVDL(32,32)",
    "RXLEVDL33":"RXLEVDL(33,33)",
    "RXLEVDL34":"RXLEVDL(34,34)",
    "RXLEVDL35":"RXLEVDL(35,35)",
    "RXLEVDL36":"RXLEVDL(36,36)",
    "RXLEVDL37":"RXLEVDL(37,37)",
    "RXLEVDL38":"RXLEVDL(38,38)",
    "RXLEVDL39":"RXLEVDL(39,39)",
    "RXLEVDL40":"RXLEVDL(40,40)",
    "RXLEVDL41":"RXLEVDL(41,41)",
    "RXLEVDL42":"RXLEVDL(42,42)",
    "RXLEVDL43":"RXLEVDL(43,43)",
    "RXLEVDL44":"RXLEVDL(44,44)",
    "RXLEVDL45":"RXLEVDL(45,45)",
    "RXLEVDL46":"RXLEVDL(46,46)",
    "RXLEVDL47":"RXLEVDL(47,47)",
    "RXLEVDL48":"RXLEVDL(48,48)",
    "RXLEVDL49":"RXLEVDL(49,49)",
    "RXLEVDL50":"RXLEVDL(50,50)",
    "RXLEVDL51":"RXLEVDL(51,51)",
    "RXLEVDL52":"RXLEVDL(52,52)",
    "RXLEVDL53":"RXLEVDL(53,53)",
    "RXLEVDL54":"RXLEVDL(54,54)",
    "RXLEVDL55":"RXLEVDL(55,55)",
    "RXLEVDL56":"RXLEVDL(56,56)",
    "RXLEVDL57":"RXLEVDL(57,57)",
    "RXLEVDL58":"RXLEVDL(58,58)",
    "RXLEVDL59":"RXLEVDL(59,59)",
    "RXLEVDL60":"RXLEVDL(60,60)",
    "RXLEVDL61":"RXLEVDL(61,61)",
    "RXLEVDL62":"RXLEVDL(62,62)",
    "RXLEVDL63":"RXLEVDL(63,63)",
    "PLOSSUL0":"PATHLOSSUL(30,31)",
    "PLOSSUL1":"PATHLOSSUL(32,33)",
    "PLOSSUL2":"PATHLOSSUL(34,35)",
    "PLOSSUL3":"PATHLOSSUL(36,37)",
    "PLOSSUL4":"PATHLOSSUL(38,39)",
    "PLOSSUL5":"PATHLOSSUL(40,41)",
    "PLOSSUL6":"PATHLOSSUL(42,43)",
    "PLOSSUL7":"PATHLOSSUL(44,45)",
    "PLOSSUL8":"PATHLOSSUL(46,47)",
    "PLOSSUL9":"PATHLOSSUL(48,49)",
    "PLOSSUL10":"PATHLOSSUL(50,51)",
    "PLOSSUL11":"PATHLOSSUL(52,53)",
    "PLOSSUL12":"PATHLOSSUL(54,55)",
    "PLOSSUL13":"PATHLOSSUL(56,57)",
    "PLOSSUL14":"PATHLOSSUL(58,59)",
    "PLOSSUL15":"PATHLOSSUL(60,61)",
    "PLOSSUL16":"PATHLOSSUL(62,63)",
    "PLOSSUL17":"PATHLOSSUL(64,65)",
    "PLOSSUL18":"PATHLOSSUL(66,67)",
    "PLOSSUL19":"PATHLOSSUL(68,69)",
    "PLOSSUL20":"PATHLOSSUL(70,71)",
    "PLOSSUL21":"PATHLOSSUL(72,73)",
    "PLOSSUL22":"PATHLOSSUL(74,75)",
    "PLOSSUL23":"PATHLOSSUL(76,77)",
    "PLOSSUL24":"PATHLOSSUL(78,79)",
    "PLOSSUL25":"PATHLOSSUL(80,81)",
    "PLOSSUL26":"PATHLOSSUL(82,83)",
    "PLOSSUL27":"PATHLOSSUL(84,85)",
    "PLOSSUL28":"PATHLOSSUL(86,87)",
    "PLOSSUL29":"PATHLOSSUL(88,89)",
    "PLOSSUL30":"PATHLOSSUL(90,91)",
    "PLOSSUL31":"PATHLOSSUL(92,93)",
    "PLOSSUL32":"PATHLOSSUL(94,95)",
    "PLOSSUL33":"PATHLOSSUL(96,97)",
    "PLOSSUL34":"PATHLOSSUL(98,99)",
    "PLOSSUL35":"PATHLOSSUL(100,101)",
    "PLOSSUL36":"PATHLOSSUL(102,103)",
    "PLOSSUL37":"PATHLOSSUL(104,105)",
    "PLOSSUL38":"PATHLOSSUL(106,107)",
    "PLOSSUL39":"PATHLOSSUL(108,109)",
    "PLOSSUL40":"PATHLOSSUL(110,111)",
    "PLOSSUL41":"PATHLOSSUL(112,113)",
    "PLOSSUL42":"PATHLOSSUL(114,115)",
    "PLOSSUL43":"PATHLOSSUL(116,117)",
    "PLOSSUL44":"PATHLOSSUL(118,119)",
    "PLOSSUL45":"PATHLOSSUL(120,121)",
    "PLOSSUL46":"PATHLOSSUL(122,123)",
    "PLOSSUL47":"PATHLOSSUL(124,125)",
    "PLOSSUL48":"PATHLOSSUL(126,127)",
    "PLOSSUL49":"PATHLOSSUL(128,129)",
    "PLOSSUL50":"PATHLOSSUL(130,131)",
    "PLOSSUL51":"PATHLOSSUL(132,133)",
    "PLOSSUL52":"PATHLOSSUL(134,135)",
    "PLOSSUL53":"PATHLOSSUL(136,137)",
    "PLOSSUL54":"PATHLOSSUL(138,139)",
    "PLOSSUL55":"PATHLOSSUL(140,141)",
    "PLOSSUL56":"PATHLOSSUL(142,143)",
    "PLOSSUL57":"PATHLOSSUL(144,145)",
    "PLOSSUL58":"PATHLOSSUL(146,147)",
    "PLOSSUL59":"PATHLOSSUL(148,153)",
    "PLOSSDL0":"PATHLOSSDL(30,31)",
    "PLOSSDL1":"PATHLOSSDL(32,33)",
    "PLOSSDL2":"PATHLOSSDL(34,35)",
    "PLOSSDL3":"PATHLOSSDL(36,37)",
    "PLOSSDL4":"PATHLOSSDL(38,39)",
    "PLOSSDL5":"PATHLOSSDL(40,41)",
    "PLOSSDL6":"PATHLOSSDL(42,43)",
    "PLOSSDL7":"PATHLOSSDL(44,45)",
    "PLOSSDL8":"PATHLOSSDL(46,47)",
    "PLOSSDL9":"PATHLOSSDL(48,49)",
    "PLOSSDL10":"PATHLOSSDL(50,51)",
    "PLOSSDL11":"PATHLOSSDL(52,53)",
    "PLOSSDL12":"PATHLOSSDL(54,55)",
    "PLOSSDL13":"PATHLOSSDL(56,57)",
    "PLOSSDL14":"PATHLOSSDL(58,59)",
    "PLOSSDL15":"PATHLOSSDL(60,61)",
    "PLOSSDL16":"PATHLOSSDL(62,63)",
    "PLOSSDL17":"PATHLOSSDL(64,65)",
    "PLOSSDL18":"PATHLOSSDL(66,67)",
    "PLOSSDL19":"PATHLOSSDL(68,69)",
    "PLOSSDL20":"PATHLOSSDL(70,71)",
    "PLOSSDL21":"PATHLOSSDL(72,73)",
    "PLOSSDL22":"PATHLOSSDL(74,75)",
    "PLOSSDL23":"PATHLOSSDL(76,77)",
    "PLOSSDL24":"PATHLOSSDL(78,79)",
    "PLOSSDL25":"PATHLOSSDL(80,81)",
    "PLOSSDL26":"PATHLOSSDL(82,83)",
    "PLOSSDL27":"PATHLOSSDL(84,85)",
    "PLOSSDL28":"PATHLOSSDL(86,87)",
    "PLOSSDL29":"PATHLOSSDL(88,89)",
    "PLOSSDL30":"PATHLOSSDL(90,91)",
    "PLOSSDL31":"PATHLOSSDL(92,93)",
    "PLOSSDL32":"PATHLOSSDL(94,95)",
    "PLOSSDL33":"PATHLOSSDL(96,97)",
    "PLOSSDL34":"PATHLOSSDL(98,99)",
    "PLOSSDL35":"PATHLOSSDL(100,101)",
    "PLOSSDL36":"PATHLOSSDL(102,103)",
    "PLOSSDL37":"PATHLOSSDL(104,105)",
    "PLOSSDL38":"PATHLOSSDL(106,107)",
    "PLOSSDL39":"PATHLOSSDL(108,109)",
    "PLOSSDL40":"PATHLOSSDL(110,111)",
    "PLOSSDL41":"PATHLOSSDL(112,113)",
    "PLOSSDL42":"PATHLOSSDL(114,115)",
    "PLOSSDL43":"PATHLOSSDL(116,117)",
    "PLOSSDL44":"PATHLOSSDL(118,119)",
    "PLOSSDL45":"PATHLOSSDL(120,121)",
    "PLOSSDL46":"PATHLOSSDL(122,123)",
    "PLOSSDL47":"PATHLOSSDL(124,125)",
    "PLOSSDL48":"PATHLOSSDL(126,127)",
    "PLOSSDL49":"PATHLOSSDL(128,129)",
    "PLOSSDL50":"PATHLOSSDL(130,131)",
    "PLOSSDL51":"PATHLOSSDL(132,133)",
    "PLOSSDL52":"PATHLOSSDL(134,135)",
    "PLOSSDL53":"PATHLOSSDL(136,137)",
    "PLOSSDL54":"PATHLOSSDL(138,139)",
    "PLOSSDL55":"PATHLOSSDL(140,141)",
    "PLOSSDL56":"PATHLOSSDL(142,143)",
    "PLOSSDL57":"PATHLOSSDL(144,145)",
    "PLOSSDL58":"PATHLOSSDL(146,147)",
    "PLOSSDL59":"PATHLOSSDL(148,149)",
    "PLOSSDL60":"PATHLOSSDL(150,151)",
    "PLOSSDL61":"PATHLOSSDL(152,153)",
    "PLOSSDL62":"PATHLOSSDL(154,155)",
    "PLOSSDL63":"PATHLOSSDL(156,157)",
    "PLOSSDL64":"PATHLOSSDL(158,190)",
    "BSPOWER15":"BSPOWER(-30,-30)",
    "BSPOWER14":"BSPOWER(-28,-28)",
    "BSPOWER13":"BSPOWER(-26,-26)",
    "BSPOWER12":"BSPOWER(-24,-24)",
    "BSPOWER11":"BSPOWER(-22,-22)",
    "BSPOWER10":"BSPOWER(-20,-20)",
    "BSPOWER9":"BSPOWER(-18,-18)",
    "BSPOWER8":"BSPOWER(-16,-16)",
    "BSPOWER7":"BSPOWER(-14,-14)",
    "BSPOWER6":"BSPOWER(-12,-12)",
    "BSPOWER5":"BSPOWER(-10,-10)",
    "BSPOWER4":"BSPOWER(-8,-8)",
    "BSPOWER3":"BSPOWER(-6,-6)",
    "BSPOWER2":"BSPOWER(-4,-4)",
    "BSPOWER1":"BSPOWER(-2,-2)",
    "BSPOWER0":"BSPOWER(0,0)",
    'MSPOWER(0,0)':'MSPOWER(0,0)',
    'MSPOWER(2,2)':'MSPOWER(2,2)',
    'MSPOWER(4,4)':'MSPOWER(4,4)',
    'MSPOWER(5,5)':'MSPOWER(5,5)',
    'MSPOWER(6,6)':'MSPOWER(6,6)',
    'MSPOWER(7,7)':'MSPOWER(7,7)',
    'MSPOWER(8,8)':'MSPOWER(8,8)',
    'MSPOWER(9,9)':'MSPOWER(9,9)',
    'MSPOWER(10,10)':'MSPOWER(10,10)',
    'MSPOWER(11,11)':'MSPOWER(11,11)',
    'MSPOWER(12,12)':'MSPOWER(12,12)',
    'MSPOWER(13,13)':'MSPOWER(13,13)',
    'MSPOWER(14,14)':'MSPOWER(14,14)',
    'MSPOWER(15,15)':'MSPOWER(15,15)',
    'MSPOWER(16,16)':'MSPOWER(16,16)',
    'MSPOWER(17,17)':'MSPOWER(17,17)',
    'MSPOWER(18,18)':'MSPOWER(18,18)',
    'MSPOWER(19,19)':'MSPOWER(19,19)',
    'MSPOWER(20,20)':'MSPOWER(20,20)',
    'MSPOWER(21,21)':'MSPOWER(21,21)',
    'MSPOWER(22,22)':'MSPOWER(22,22)',
    'MSPOWER(23,23)':'MSPOWER(23,23)',
    'MSPOWER(24,24)':'MSPOWER(24,24)',
    'MSPOWER(25,25)':'MSPOWER(25,25)',
    'MSPOWER(26,26)':'MSPOWER(26,26)',
    'MSPOWER(27,27)':'MSPOWER(27,27)',
    'MSPOWER(28,28)':'MSPOWER(28,28)',
    'MSPOWER(29,29)':'MSPOWER(29,29)',
    'MSPOWER(30,30)':'MSPOWER(30,30)',
    'MSPOWER(31,31)':'MSPOWER(31,31)',
    'MSPOWER(32,32)':'MSPOWER(32,32)',
    'MSPOWER(33,33)':'MSPOWER(33,33)',
    'MSPOWER(34,34)':'MSPOWER(34,34)',
    'MSPOWER(35,35)':'MSPOWER(35,35)',
    'MSPOWER(36,36)':'MSPOWER(36,36)',
    'MSPOWER(37,37)':'MSPOWER(37,37)',
    'MSPOWER(39,39)':'MSPOWER(39,39)',
    "TAVAL0":"TAVAL(0,0)",
    "TAVAL1":"TAVAL(1,1)",
    "TAVAL2":"TAVAL(2,2)",
    "TAVAL3":"TAVAL(3,3)",
    "TAVAL4":"TAVAL(4,4)",
    "TAVAL5":"TAVAL(5,5)",
    "TAVAL6":"TAVAL(6,6)",
    "TAVAL7":"TAVAL(7,7)",
    "TAVAL8":"TAVAL(8,8)",
    "TAVAL9":"TAVAL(9,9)",
    "TAVAL10":"TAVAL(10,10)",
    "TAVAL11":"TAVAL(11,11)",
    "TAVAL12":"TAVAL(12,12)",
    "TAVAL13":"TAVAL(13,13)",
    "TAVAL14":"TAVAL(14,14)",
    "TAVAL15":"TAVAL(15,15)",
    "TAVAL16":"TAVAL(16,16)",
    "TAVAL17":"TAVAL(17,17)",
    "TAVAL18":"TAVAL(18,18)",
    "TAVAL19":"TAVAL(19,19)",
    "TAVAL20":"TAVAL(20,20)",
    "TAVAL21":"TAVAL(21,21)",
    "TAVAL22":"TAVAL(22,22)",
    "TAVAL23":"TAVAL(23,23)",
    "TAVAL24":"TAVAL(24,24)",
    "TAVAL25":"TAVAL(25,25)",
    "TAVAL26":"TAVAL(26,26)",
    "TAVAL27":"TAVAL(27,27)",
    "TAVAL28":"TAVAL(28,28)",
    "TAVAL29":"TAVAL(29,29)",
    "TAVAL30":"TAVAL(30,30)",
    "TAVAL31":"TAVAL(31,31)",
    "TAVAL32":"TAVAL(32,32)",
    "TAVAL33":"TAVAL(33,33)",
    "TAVAL34":"TAVAL(34,34)",
    "TAVAL35":"TAVAL(35,35)",
    "TAVAL36":"TAVAL(36,36)",
    "TAVAL37":"TAVAL(37,37)",
    "TAVAL38":"TAVAL(38,38)",
    "TAVAL39":"TAVAL(39,39)",
    "TAVAL40":"TAVAL(40,40)",
    "TAVAL41":"TAVAL(41,41)",
    "TAVAL42":"TAVAL(42,42)",
    "TAVAL43":"TAVAL(43,43)",
    "TAVAL44":"TAVAL(44,44)",
    "TAVAL45":"TAVAL(45,45)",
    "TAVAL46":"TAVAL(46,46)",
    "TAVAL47":"TAVAL(47,47)",
    "TAVAL48":"TAVAL(48,48)",
    "TAVAL49":"TAVAL(49,49)",
    "TAVAL50":"TAVAL(50,50)",
    "TAVAL51":"TAVAL(51,51)",
    "TAVAL52":"TAVAL(52,52)",
    "TAVAL53":"TAVAL(53,53)",
    "TAVAL54":"TAVAL(54,54)",
    "TAVAL55":"TAVAL(55,55)",
    "TAVAL56":"TAVAL(56,56)",
    "TAVAL57":"TAVAL(57,57)",
    "TAVAL58":"TAVAL(58,58)",
    "TAVAL59":"TAVAL(59,59)",
    "TAVAL60":"TAVAL(60,60)",
    "TAVAL61":"TAVAL(61,61)",
    "TAVAL62":"TAVAL(62,62)",
    "TAVAL63":"TAVAL(63,63)",
    "TAVAL64":"TAVAL(64,73)",
    "TAVAL65":"TAVAL(74,83)",
    "TAVAL66":"TAVAL(84,93)",
    "TAVAL67":"TAVAL(94,103)",
    "TAVAL68":"TAVAL(104,113)",
    "TAVAL69":"TAVAL(114,123)",
    "TAVAL70":"TAVAL(124,133)",
    "TAVAL71":"TAVAL(134,143)",
    "TAVAL72":"TAVAL(144,163)",
    "TAVAL73":"TAVAL(164,183)",
    "TAVAL74":"TAVAL(184,203)",
    "TAVAL75":"TAVAL(204,219)",
    "PLDIFF0":"PATHLOSSDIFF(-25,-25)",
    "PLDIFF1":"PATHLOSSDIFF(-24,-24)",
    "PLDIFF2":"PATHLOSSDIFF(-23,-23)",
    "PLDIFF3":"PATHLOSSDIFF(-22,-22)",
    "PLDIFF4":"PATHLOSSDIFF(-21,-21)",
    "PLDIFF5":"PATHLOSSDIFF(-20,-20)",
    "PLDIFF6":"PATHLOSSDIFF(-19,-19)",
    "PLDIFF7":"PATHLOSSDIFF(-18,-18)",
    "PLDIFF8":"PATHLOSSDIFF(-17,-17)",
    "PLDIFF9":"PATHLOSSDIFF(-16,-16)",
    "PLDIFF10":"PATHLOSSDIFF(-15,-15)",
    "PLDIFF11":"PATHLOSSDIFF(-14,-14)",
    "PLDIFF12":"PATHLOSSDIFF(-13,-13)",
    "PLDIFF13":"PATHLOSSDIFF(-12,-12)",
    "PLDIFF14":"PATHLOSSDIFF(-11,-11)",
    "PLDIFF15":"PATHLOSSDIFF(-10,-10)",
    "PLDIFF16":"PATHLOSSDIFF(-9,-9)",
    "PLDIFF17":"PATHLOSSDIFF(-8,-8)",
    "PLDIFF18":"PATHLOSSDIFF(-7,-7)",
    "PLDIFF19":"PATHLOSSDIFF(-6,-6)",
    "PLDIFF20":"PATHLOSSDIFF(-5,-5)",
    "PLDIFF21":"PATHLOSSDIFF(-4,-4)",
    "PLDIFF22":"PATHLOSSDIFF(-3,-3)",
    "PLDIFF23":"PATHLOSSDIFF(-2,-2)",
    "PLDIFF24":"PATHLOSSDIFF(-1,-1)",
    "PLDIFF25":"PATHLOSSDIFF(0,0)",
    "PLDIFF26":"PATHLOSSDIFF(1,1)",
    "PLDIFF27":"PATHLOSSDIFF(2,2)",
    "PLDIFF28":"PATHLOSSDIFF(3,3)",
    "PLDIFF29":"PATHLOSSDIFF(4,4)",
    "PLDIFF30":"PATHLOSSDIFF(5,5)",
    "PLDIFF31":"PATHLOSSDIFF(6,6)",
    "PLDIFF32":"PATHLOSSDIFF(7,7)",
    "PLDIFF33":"PATHLOSSDIFF(8,8)",
    "PLDIFF34":"PATHLOSSDIFF(9,9)",
    "PLDIFF35":"PATHLOSSDIFF(10,10)",
    "PLDIFF36":"PATHLOSSDIFF(11,11)",
    "PLDIFF37":"PATHLOSSDIFF(12,12)",
    "PLDIFF38":"PATHLOSSDIFF(13,13)",
    "PLDIFF39":"PATHLOSSDIFF(14,14)",
    "PLDIFF40":"PATHLOSSDIFF(15,15)",
    "PLDIFF41":"PATHLOSSDIFF(16,16)",
    "PLDIFF42":"PATHLOSSDIFF(17,17)",
    "PLDIFF43":"PATHLOSSDIFF(18,18)",
    "PLDIFF44":"PATHLOSSDIFF(19,19)",
    "PLDIFF45":"PATHLOSSDIFF(20,20)",
    "PLDIFF46":"PATHLOSSDIFF(21,21)",
    "PLDIFF47":"PATHLOSSDIFF(22,22)",
    "PLDIFF48":"PATHLOSSDIFF(23,23)",
    "PLDIFF49":"PATHLOSSDIFF(24,24)",
    "PLDIFF50":"PATHLOSSDIFF(25,25)",
    "FERUL0":"FERUL(0,0)",
    "FERUL1":"FERUL(1,1)",
    "FERUL2":"FERUL(2,2)",
    "FERUL3":"FERUL(3,3)",
    "FERUL4":"FERUL(4,4)",
    "FERUL5":"FERUL(5,5)",
    "FERUL6":"FERUL(6,6)",
    "FERUL7":"FERUL(7,7)",
    "FERUL8":"FERUL(8,8)",
    "FERUL9":"FERUL(9,9)",
    "FERUL10":"FERUL(10,10)",
    "FERUL11":"FERUL(11,11)",
    "FERUL12":"FERUL(12,12)",
    "FERUL13":"FERUL(13,13)",
    "FERUL14":"FERUL(14,14)",
    "FERUL15":"FERUL(15,15)",
    "FERUL16":"FERUL(16,16)",
    "FERUL17":"FERUL(17,17)",
    "FERUL18":"FERUL(18,18)",
    "FERUL19":"FERUL(19,19)",
    "FERUL20":"FERUL(20,20)",
    "FERUL21":"FERUL(21,21)",
    "FERUL22":"FERUL(22,22)",
    "FERUL23":"FERUL(23,23)",
    "FERUL24":"FERUL(24,24)",
    "FERUL25":"FERUL(25,25)",
    "FERUL26":"FERUL(26,26)",
    "FERUL27":"FERUL(27,27)",
    "FERUL28":"FERUL(28,28)",
    "FERUL29":"FERUL(29,29)",
    "FERUL30":"FERUL(30,30)",
    "FERUL31":"FERUL(31,31)",
    "FERUL32":"FERUL(32,32)",
    "FERUL33":"FERUL(33,33)",
    "FERUL34":"FERUL(34,34)",
    "FERUL35":"FERUL(35,35)",
    "FERUL36":"FERUL(36,36)",
    "FERUL37":"FERUL(37,37)",
    "FERUL38":"FERUL(38,38)",
    "FERUL39":"FERUL(39,39)",
    "FERUL40":"FERUL(40,40)",
    "FERUL41":"FERUL(41,41)",
    "FERUL42":"FERUL(42,42)",
    "FERUL43":"FERUL(43,43)",
    "FERUL44":"FERUL(44,44)",
    "FERUL45":"FERUL(45,45)",
    "FERUL46":"FERUL(46,46)",
    "FERUL47":"FERUL(47,47)",
    "FERUL48":"FERUL(48,48)",
    "FERUL49":"FERUL(49,49)",
    "FERUL50":"FERUL(50,50)",
    "FERUL51":"FERUL(51,51)",
    "FERUL52":"FERUL(52,52)",
    "FERUL53":"FERUL(53,53)",
    "FERUL54":"FERUL(54,54)",
    "FERUL55":"FERUL(55,55)",
    "FERUL56":"FERUL(56,56)",
    "FERUL57":"FERUL(57,57)",
    "FERUL58":"FERUL(58,58)",
    "FERUL59":"FERUL(59,59)",
    "FERUL60":"FERUL(60,60)",
    "FERUL61":"FERUL(61,61)",
    "FERUL62":"FERUL(62,62)",
    "FERUL63":"FERUL(63,63)",
    "FERUL64":"FERUL(64,64)",
    "FERUL65":"FERUL(65,65)",
    "FERUL66":"FERUL(66,66)",
    "FERUL67":"FERUL(67,67)",
    "FERUL68":"FERUL(68,68)",
    "FERUL69":"FERUL(69,69)",
    "FERUL70":"FERUL(70,70)",
    "FERUL71":"FERUL(71,71)",
    "FERUL72":"FERUL(72,72)",
    "FERUL73":"FERUL(73,73)",
    "FERUL74":"FERUL(74,74)",
    "FERUL75":"FERUL(75,75)",
    "FERUL76":"FERUL(76,76)",
    "FERUL77":"FERUL(77,77)",
    "FERUL78":"FERUL(78,78)",
    "FERUL79":"FERUL(79,79)",
    "FERUL80":"FERUL(80,80)",
    "FERUL81":"FERUL(81,81)",
    "FERUL82":"FERUL(82,82)",
    "FERUL83":"FERUL(83,83)",
    "FERUL84":"FERUL(84,84)",
    "FERUL85":"FERUL(85,85)",
    "FERUL86":"FERUL(86,86)",
    "FERUL87":"FERUL(87,87)",
    "FERUL88":"FERUL(88,88)",
    "FERUL89":"FERUL(89,89)",
    "FERUL90":"FERUL(90,90)",
    "FERUL91":"FERUL(91,91)",
    "FERUL92":"FERUL(92,92)",
    "FERUL93":"FERUL(93,93)",
    "FERUL94":"FERUL(94,94)",
    "FERUL95":"FERUL(95,95)",
    "FERUL96":"FERUL(96,96)",
    "FERDL0":"FERDL(0,0)",
    "FERDL1":"FERDL(1,1)",
    "FERDL2":"FERDL(2,2)",
    "FERDL3":"FERDL(3,3)",
    "FERDL4":"FERDL(4,4)",
    "FERDL5":"FERDL(5,5)",
    "FERDL6":"FERDL(6,6)",
    "FERDL7":"FERDL(7,7)",
    "FERDL8":"FERDL(8,8)",
    "FERDL9":"FERDL(9,9)",
    "FERDL10":"FERDL(10,10)",
    "FERDL11":"FERDL(11,11)",
    "FERDL12":"FERDL(12,12)",
    "FERDL13":"FERDL(13,13)",
    "FERDL14":"FERDL(14,14)",
    "FERDL15":"FERDL(15,15)",
    "FERDL16":"FERDL(16,16)",
    "FERDL17":"FERDL(17,17)",
    "FERDL18":"FERDL(18,18)",
    "FERDL19":"FERDL(19,19)",
    "FERDL20":"FERDL(20,20)",
    "FERDL21":"FERDL(21,21)",
    "FERDL22":"FERDL(22,22)",
    "FERDL23":"FERDL(23,23)",
    "FERDL24":"FERDL(24,24)",
    "FERDL25":"FERDL(25,25)",
    "FERDL26":"FERDL(26,26)",
    "FERDL27":"FERDL(27,27)",
    "FERDL28":"FERDL(28,28)",
    "FERDL29":"FERDL(29,29)",
    "FERDL30":"FERDL(30,30)",
    "FERDL31":"FERDL(31,31)",
    "FERDL32":"FERDL(32,32)",
    "FERDL33":"FERDL(33,33)",
    "FERDL34":"FERDL(34,34)",
    "FERDL35":"FERDL(35,35)",
    "FERDL36":"FERDL(36,36)",
    "FERDL37":"FERDL(37,37)",
    "FERDL38":"FERDL(38,38)",
    "FERDL39":"FERDL(39,39)",
    "FERDL40":"FERDL(40,40)",
    "FERDL41":"FERDL(41,41)",
    "FERDL42":"FERDL(42,42)",
    "FERDL43":"FERDL(43,43)",
    "FERDL44":"FERDL(44,44)",
    "FERDL45":"FERDL(45,45)",
    "FERDL46":"FERDL(46,46)",
    "FERDL47":"FERDL(47,47)",
    "FERDL48":"FERDL(48,48)",
    "FERDL49":"FERDL(49,49)",
    "FERDL50":"FERDL(50,50)",
    "FERDL51":"FERDL(51,51)",
    "FERDL52":"FERDL(52,52)",
    "FERDL53":"FERDL(53,53)",
    "FERDL54":"FERDL(54,54)",
    "FERDL55":"FERDL(55,55)",
    "FERDL56":"FERDL(56,56)",
    "FERDL57":"FERDL(57,57)",
    "FERDL58":"FERDL(58,58)",
    "FERDL59":"FERDL(59,59)",
    "FERDL60":"FERDL(60,60)",
    "FERDL61":"FERDL(61,61)",
    "FERDL62":"FERDL(62,62)",
    "FERDL63":"FERDL(63,63)",
    "FERDL64":"FERDL(64,64)",
    "FERDL65":"FERDL(65,65)",
    "FERDL66":"FERDL(66,66)",
    "FERDL67":"FERDL(67,67)",
    "FERDL68":"FERDL(68,68)",
    "FERDL69":"FERDL(69,69)",
    "FERDL70":"FERDL(70,70)",
    "FERDL71":"FERDL(71,71)",
    "FERDL72":"FERDL(72,72)",
    "FERDL73":"FERDL(73,73)",
    "FERDL74":"FERDL(74,74)",
    "FERDL75":"FERDL(75,75)",
    "FERDL76":"FERDL(76,76)",
    "FERDL77":"FERDL(77,77)",
    "FERDL78":"FERDL(78,78)",
    "FERDL79":"FERDL(79,79)",
    "FERDL80":"FERDL(80,80)",
    "FERDL81":"FERDL(81,81)",
    "FERDL82":"FERDL(82,82)",
    "FERDL83":"FERDL(83,83)",
    "FERDL84":"FERDL(84,84)",
    "FERDL85":"FERDL(85,85)",
    "FERDL86":"FERDL(86,86)",
    "FERDL87":"FERDL(87,87)",
    "FERDL88":"FERDL(88,88)",
    "FERDL89":"FERDL(89,89)",
    "FERDL90":"FERDL(90,90)",
    "FERDL91":"FERDL(91,91)",
    "FERDL92":"FERDL(92,92)",
    "FERDL93":"FERDL(93,93)",
    "FERDL94":"FERDL(94,94)",
    "FERDL95":"FERDL(95,95)",
    "FERDL96":"FERDL(96,96)"
}

# som of the columns dont need to be ran through the generate_grouped_calc_cols as
# it is already at cell, channel group level or doesnt need to be grouped etc.
exclude_list = [
        "Cell Name",
        "ChannelGroup",
        "SubCell_String",
        "No._of_Meas._Rep_Passed_Filter_MSMT",
        "NoReportsUnfiltered_MSMT",
        "Traffic Level Average (E)_MSMT",
        "TrafficLevelMaxCS(E)_MSMT",
        "TrafficLevelMinCS(E)_MSMT",
        "No. of FER UL Passed Filter_MSMT",
        "NoFERULUnfiltered_MSMT",
        "No. of FER DL Passed Filter_MSMT",
        "NoFERDLUnfiltered_MSMT",
        "No. of FER UL&DL Passed Filter_MSMT",
        "NoFERULDLUnfiltered_MSMT",
        "CELL_BAND"
    ]


def generate_grouped_calc_columns(calc_columns, data_table_name):
    """ function for grouped reocording. Creates new columns with sum over to group them together"""

    data_table = Document.Data.Tables[data_table_name]
    table_columns = data_table.Columns

    for counter,column_name in calc_columns.items():
        # mspower are calculated differently so dont need to have the name changed
        if counter not in exclude_list and 'MSPOWER' not in column_name:
            formula = "SUM([{0}]) OVER ([Cell Name],[ChannelGroup])".format(counter)
            table_columns.AddCalculatedColumn(column_name,formula)

    #if grouping then need to remove duplicates in ch group, cell
    dupFormula = "TERR_Boolean('output <- duplicated(data.frame(input1, input2))',[Cell Name], [ChannelGroup])"

    table_columns.AddCalculatedColumn('IsDuplicate',dupFormula)

Document.Properties["errorMessage"] = ''
Document.Properties["removeGroupMessage"] = ""
sourceDataTableName = ""

page = Application.Document.ActivePageReference
if page.Title == 'MRR Recordings - Single Recording':
    sourceDataTableName = "combinedRecordingData"
    print 'here'
    reportType = 'single'
else:
    sourceDataTableName = "combinedRecordingDataGrouping"
    reportType = 'group'


# create table for MSMT based of source table
sourceDataTable = Document.Data.Tables[sourceDataTableName]

dataSource=DataTableDataSource(sourceDataTable)

if Document.Data.Tables.Contains("msmtExport"):
    Document.Data.Tables.Remove(Document.Data.Tables["msmtExport"])

newTable = Document.Data.Tables.Add("msmtExport", dataSource)

sourceDataTableName = "msmtExport"
sourceDataTable = Document.Data.Tables[sourceDataTableName]

# columns to delete from MSMT table (the ones we need end with MSMT)
#cell Name is added as calculated column so orignal column can be removed:
#Concatenate([BSC_Node_Name], null, Substitute([CellName],[BSC_Node_Name], "/"))

deleteCols = [
    "CellName",
    "No. of Meas. Rep Passed Filter",
    "NoReportsUnfiltered",
    "Traffic Level Average (E)",
    "TrafficLevelMaxCS(E)",
    "TrafficLevelMinCS(E)",
    "No. of FER UL Passed Filter",
    "NoFERULUnfiltered",
    "No. of FER DL Passed Filter",
    "NoFERDLUnfiltered",
    "No. of FER UL&DL Passed Filter",
    "NoFERULDLUnfiltered"
]

columnsToDelete = List[DataColumn]()
for column in sourceDataTable.Columns:
    if column.Name in deleteCols:
        columnsToDelete.Add(column)

sourceDataTable.Columns.Remove(columnsToDelete)

# sum together the counters if its a group recording
if reportType == 'group':
    generate_grouped_calc_columns(msmtColumns,sourceDataTableName)

# get a lsit of column names required based on dict at top of script
allColumnNames = []
for column in sourceDataTable.Columns:
    if reportType == 'single':
        if column.Name in msmtColumns:
            column.Name = msmtColumns[column.Name]
            allColumnNames.append(column.Name)
    else:
        if column.Name in exclude_list:
            column.Name = msmtColumns[column.Name]
            allColumnNames.append(column.Name)
        elif column.Name in msmtColumns.values():
            allColumnNames.append(column.Name)

# create directory for msmt exports
if not Directory.Exists("C:\\NetAn_MRRMSMT_Exports"):
    Directory.CreateDirectory("C:\\NetAn_MRRMSMT_Exports")

fileName = "MRR_MSMT"+str(datetime.today().strftime('%Y%m%d%H%M%S'))+".xlsx"

stream = File.OpenWrite("C:\\NetAn_MRRMSMT_Exports\\"+fileName)

writer = Document.Data.CreateDataWriter(DataWriterTypeIdentifiers.ExcelXlsxDataWriter)

#if a group then just select the non duplicated.
if reportType == 'group':
    rowSelection=sourceDataTable.Select("[IsDuplicate] != TRUE")
    allRows = rowSelection.AsIndexSet()
else:
    allRows = Document.Data.AllRows.GetSelection(sourceDataTable).AsIndexSet()

writer.Write(stream, sourceDataTable, allRows, allColumnNames)
stream.Close()
stream.Dispose()

Document.Data.Tables.Remove(Document.Data.Tables["msmtExport"])
Document.Properties["ActionMessage"] = "File exported to 'C:\\NetAn_MRRMSMT_Exports'"

